<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'êµ¬ì¥ ìƒì„¸ (' + ${stadiumId} + ') - MULTI FC'">MULTI FC - êµ¬ì¥ ìƒì„¸</title>

    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        .stadium-main {
            padding: 100px 40px 40px 40px;
            background-color: #f7f7f7;
            min-height: 100vh;
        }
        .stadium-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }
        .stadium-title {
            grid-column: 1 / -1;
            font-size: 32px;
            font-weight: 800;
            color: #333;
            margin-bottom: 5px;
            border-bottom: 3px solid #6c5ce7;
            padding-bottom: 10px;
        }

        .detail-left-column {
            grid-column: 1 / 2;
            display: flex;
            flex-direction: column;
        }

        .map-area {
            width: 100%;
            height: 350px;
            background-color: #eee;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #888;
        }

        .review-right-column {
            grid-column: 2 / 3;
            grid-row: 2 / span 2;
            background: #fcfcfc;
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #ddd;
            max-height: 685px;
            overflow-y: auto;
        }

        .info-card {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-top: 0;
        }
        .info-card h2{
            margin-bottom: 20px;
        }
        .info-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .info-item i {
            width: 25px;
            color: #6c5ce7;
            margin-right: 10px;
        }
        .amenities-list {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            font-size: 14px;
        }
        .amenity-tag {
            display: inline-block;
            background: #e6e6ff;
            color: #6c5ce7;
            padding: 5px 10px;
            border-radius: 20px;
            margin-right: 8px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .action-button-group {
            text-align: center;
            grid-column: 1 / 2;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .action-button-group a {
            display: inline-block;
            padding: 14px 28px;
            font-weight: 700;
            border-radius: 30px;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            font-size: 16px;
            flex-grow: 0;
            flex-shrink: 0;
        }
        .btn-schedule {
            background-color: #333;
            color: white;
            border: 2px solid #1a1a1a;
        }
        .btn-schedule:hover {
            background-color: #1a1a1a;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }
        .btn-create-match {
            background-color: #e74c3c;
            color: white;
            border: 2px solid #c0392b;
        }
        .btn-create-match:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(231, 76, 60, 0.3);
        }

        .review-right-column h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 15px;
        }

        #review-list {
            min-height: 300px;
        }
        .review-item {
            border-bottom: 1px solid #eee;
            padding: 15px 0;
        }
        .review-item:last-child {
            border-bottom: none;
        }
        .review-header {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .review-user {
            font-weight: 700;
            color: #6c5ce7;
            display: flex;
            align-items: center;
        }
        .review-date {
            color: #999;
        }
        .review-content {
            font-size: 15px;
            line-height: 1.5;
            color: #333;
        }
        .review-item .star-display {
            color: #f39c12;
            font-size: 18px;
            margin-right: 10px;
            letter-spacing: 2px;
        }

        .review-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 5px;
            justify-content: flex-end;
        }
        .review-actions button {
            background: none;
            border: none;
            color: #6c5ce7;
            font-size: 13px;
            cursor: pointer;
            padding: 2px 5px;
            transition: color 0.2s;
        }
        .review-actions button.delete {
            color: #e74c3c;
        }

        .pagination-controls {
            text-align: center;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        .pagination-controls button {
            background: none;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px 10px;
            margin: 0 5px;
            color: #555;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .pagination-controls button:hover:not(:disabled) {
            background-color: #f0f0f0;
        }
        .pagination-controls button.active {
            background-color: #6c5ce7;
            color: white;
            border-color: #6c5ce7;
        }
        .pagination-controls button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        .tab-header {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 15px;
        }
        .tab-button {
            flex: 1;
            text-align: center;
            padding: 10px 0;
            cursor: pointer;
            font-weight: 700;
            font-size: 15px;
            border: none;
            background: none;
            outline: none;
            transition: all 0.2s ease;
        }
        .tab-button.active {
            color: #6c5ce7;
            border-bottom: 3px solid #6c5ce7;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }

        /* âœ… ê²½ê¸° ê°œì„¤ ëª¨ë‹¬ */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }
        .modal-overlay.show {
            display: flex;
        }
        .modal-content {
            background: #fff;
            border-radius: 15px;
            padding: 25px 25px 20px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.25);
        }
        .modal-content h2 {
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: 800;
            color: #2c3e50;
        }
        .modal-content label {
            display: block;
            font-size: 15px;
            font-weight: 700;
            color: #34495e;
            margin-top: 10px;
            margin-bottom: 6px;
        }
        .modal-content input[type="text"],
        .modal-content input[type="date"],
        .modal-content select {
            width: 100%;
            padding: 10px 12px;
            font-size: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            background-color: #f9f9f9;
            color: #333;
        }
        .modal-content input[type="text"]:focus,
        .modal-content input[type="date"]:focus,
        .modal-content select:focus {
            border-color: #6c5ce7;
            outline: none;
            box-shadow: 0 0 0 3px rgba(108, 92, 231, 0.2);
        }
        .modal-content input[type="text"][readonly] {
            background-color: #e9ecef;
            color: #495057;
            font-weight: 600;
            border: 1px solid #ced4da;
        }
        .time-select-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .time-select-group select {
            flex-grow: 1;
            min-width: 120px;
        }
        .time-select-group span {
            font-size: 18px;
            color: #555;
            font-weight: 600;
        }
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        .btn-cancel,
        .btn-create {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-cancel {
            background-color: #e0e0e0;
            color: #555;
        }
        .btn-cancel:hover {
            background-color: #bdbdbd;
        }
        .btn-create {
            background-color: #333;
            color: #fff;
        }
        .btn-create:hover {
            background-color: #111;
        }

        /* âœ… ê²½ê¸° ëª©ë¡ UI */
        .match-filter {
            margin-bottom: 10px;
            font-size: 14px;
        }
        .match-filter label {
            font-weight: 600;
            margin-right: 8px;
        }
        .match-filter input[type="date"] {
            padding: 6px 8px;
            font-size: 14px;
            border-radius: 6px;
            border: 1px solid #ddd;
            background-color: #fff;
        }
        .match-list {
            margin-top: 10px;
            border-top: 1px solid #eee;
        }
        .match-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        .match-item:last-child {
            border-bottom: none;
        }
        .match-item-time {
            font-weight: 700;
            color: #333;
        }
        .match-item-meta {
            font-size: 13px;
            color: #777;
        }
        .match-item:hover .match-item-time {
            text-decoration: underline;
        }

        /* âœ… ëª¨ì§‘ì¤‘/ë§ˆê° ìƒíƒœ í‘œì‹œ */
        .match-status {
            font-weight: 700;
            margin-left: 4px;
        }
        .match-status.open {
            color: #27ae60; /* ëª¨ì§‘ì¤‘: ì´ˆë¡ */
        }
        .match-status.closed {
            color: #e74c3c; /* ë§ˆê°: ë¹¨ê°• */
        }
    </style>
</head>
<body>

<header class="quick-menu">
    <div class="logo"><a href="/">MULTI FC</a></div>
    <div class="header-icons">
        <button id="profile-menu-toggle" class="profile-icon" style="position: relative; display: block;">
            <i class="fas fa-user-circle"></i>
            <span id="notification-badge" class="notification-badge"></span>
        </button>
        <div id="profile-menu" class="user-menu">
            <div class="user-info">
                <strong><span id="user-menu-username">ì‚¬ìš©ì</span>ë‹˜</strong>
                <p>í™˜ì˜í•©ë‹ˆë‹¤!</p>
            </div>
            <ul>
                <li><a href="/notifications" id="nav-notifications-link"><i class="fas fa-bell"></i> ì•Œë¦¼ ëª©ë¡</a></li>
                <li><a href="/mypage"><i class="fas fa-user"></i> ë§ˆì´í˜ì´ì§€</a></li>
                <li><a href="/profile/edit"><i class="fas fa-user-edit"></i> í”„ë¡œí•„ ìˆ˜ì •</a></li>
                <li><a href="#" id="logout-button"><i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ</a></li>
            </ul>
        </div>
        <button id="menu-toggle" class="menu-toggle-btn"><i class="fas fa-bars"></i></button>
    </div>
    <nav id="main-menu" class="main-nav">
        <ul>
            <li><a href="/"><i class="fas fa-home"></i> ë©”ì¸ (Home)</a></li>
            <li><a href="/fields" class="active"><i class="fas fa-search"></i> êµ¬ì¥ê²€ìƒ‰</a></li>
            <li><a href="/community"><i class="fas fa-users"></i> ì»¤ë®¤ë‹ˆí‹°</a></li>
            <li id="nav-chat-link-li"><a href="/chat" id="nav-chat-link"><i class="fas fa-comments"></i> ì‹¤ì‹œê°„ì±„íŒ…</a></li>
            <li><a href="/schedule"><i class="fas fa-calendar-alt"></i> ì¼ì •</a></li>
        </ul>
    </nav>
</header>

<main class="stadium-main">
    <div class="stadium-container">

        <h1 class="stadium-title" id="stadium-name">ê°•ë‚¨ í’‹ì‚´ ì•„ë ˆë‚˜ (ID: <span th:text="${stadiumId}">1</span>)</h1>

        <div class="detail-left-column">

            <div class="map-area" id="map">
                (KakaoMap APIê°€ í‘œì‹œë  êµ¬ì¥ ìœ„ì¹˜)
            </div>

            <div class="info-card">
                <h2>êµ¬ì¥ ê¸°ë³¸ ì •ë³´</h2>

                <div class="info-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span id="stadium-address">ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-phone"></i>
                    <span id="stadium-contact">02-1234-5678</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-won-sign"></i>
                    <span id="stadium-fee">50,000ì›/ì‹œê°„</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-users"></i>
                    <span id="stadium-size">5 vs 5</span>
                </div>
            </div>

        </div>

        <div class="review-right-column">

            <!-- íƒ­ í—¤ë” -->
            <div class="tab-header">
                <button id="tab-btn-match" class="tab-button active">ê²½ê¸°</button>
                <button id="tab-btn-review" class="tab-button">í›„ê¸°</button>
            </div>

            <!-- ê²½ê¸° íƒ­ -->
            <div id="tab-match" class="tab-content">
                <h2 style="font-size: 24px; color: #333; margin-bottom: 15px;">âš½ ê²½ê¸° ì •ë³´</h2>

                <div class="match-filter">
                    <label for="match-date-filter">ë‚ ì§œ ì„ íƒ</label>
                    <input type="date" id="match-date-filter">
                </div>

                <div id="match-list" class="match-list">
                    <p style="color:#777; font-size:13px; padding:10px 0;">
                        ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´, ì´ êµ¬ì¥ì—ì„œ ì§„í–‰ ì˜ˆì •ì¸ ê²½ê¸°ê°€ ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>

            <!-- í›„ê¸° íƒ­ -->
            <div id="tab-review" class="tab-content active">
                <h2 style="font-size: 24px; color: #333; margin-bottom: 15px;">
                    â­ êµ¬ì¥ ë¦¬ë·° (<span id="review-count">0</span>ê±´)
                </h2>

                <div id="review-list"></div>

                <div id="pagination-controls" class="pagination-controls" style="display:none;">
                    <button id="prev-page">&lt;</button>
                    <div id="page-numbers" style="display: inline;"></div>
                    <button id="next-page">&gt;</button>
                </div>
            </div>

        </div>

        <div class="action-button-group">
            <a href="/schedule?stadiumId=1" class="btn-schedule" id="btn-schedule">
                <i class="fas fa-calendar-alt"></i> ë§¤ì¹˜/ì¼ì • í™•ì¸
            </a>

            <a href="/match/create" class="btn-create-match" id="btn-create-match">
                <i class="fas fa-plus-circle"></i> ê²½ê¸° ìƒì„±
            </a>
        </div>

    </div>
</main>

<!-- ê²½ê¸° ê°œì„¤ ëª¨ë‹¬ -->
<div id="match-create-modal" class="modal-overlay">
    <div class="modal-content">
        <h2>ê²½ê¸° ê°œì„¤</h2>

        <label for="hostName">ì£¼ìµœì</label>
        <input type="text" id="hostName" value="ë¡œê·¸ì¸ ì‚¬ìš©ì" readonly>

        <label for="stadiumName" style="margin-top: 10px;">ì¥ì†Œ</label>
        <input type="text" id="stadiumName" value="êµ¬ì¥ ì •ë³´ ì—†ìŒ" readonly>
        <input type="hidden" id="stadiumId" name="stadiumId">

        <label for="matchDate" style="margin-top: 10px;">ë‚ ì§œ</label>
        <input type="date" id="matchDate" name="matchDate" required>

        <label for="startTime" style="margin-top: 10px;">ì‹œê°„</label>
        <div class="time-select-group">
            <select id="startTime" name="startTime"></select>
            <span>~</span>
            <select id="endTime" name="endTime"></select>
        </div>

        <div class="modal-actions">
            <button class="btn-cancel" onclick="openMatchModal(false)">ì·¨ì†Œ</button>
            <button class="btn-create" onclick="submitMatchForm()">ìƒì„±</button>
        </div>
    </div>
</div>

<script>
    // --- ê³µí†µ ë©”ë‰´ í† ê¸€ ë° ì¸ì¦ ë¡œì§ ---
    const menuToggle = document.getElementById('menu-toggle');
    const mainMenu = document.getElementById('main-menu');
    const profileMenuToggle = document.getElementById('profile-menu-toggle');
    const profileMenu = document.getElementById('profile-menu');
    const logoutButton = document.getElementById('logout-button');
    const navNotificationsLink = document.getElementById('nav-notifications-link');

    if (menuToggle) {
        menuToggle.addEventListener('click', () => {
            if (mainMenu) mainMenu.classList.toggle('show');
            if (profileMenu) profileMenu.classList.remove('show');
        });
    }

    if (profileMenuToggle) {
        profileMenuToggle.addEventListener('click', () => {
            if (profileMenu) profileMenu.classList.toggle('show');
            if (mainMenu) mainMenu.classList.remove('show');
        });
    }

    document.addEventListener('click', (e) => {
        const header = document.querySelector('header');
        if (header && !header.contains(e.target)) {
            if (mainMenu) mainMenu.classList.remove('show');
            if (profileMenu) profileMenu.classList.remove('show');
        }
    });

    if (logoutButton) {
        logoutButton.addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('accessToken');
            localStorage.removeItem('hasReadReviews');
            localStorage.removeItem('hasReadSchedules');
            window.location.href = '/login';
        });
    }

    if (navNotificationsLink) {
        navNotificationsLink.addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.setItem('hasReadReviews', 'true');
            localStorage.setItem('hasReadSchedules', 'true');
            window.location.href = '/notifications';
        });
    }

    function updateGlobalBadge() {
        const hasNew = localStorage.getItem('hasNewNotification') === 'true';
        const badge = document.getElementById('notification-badge');
        if (badge) badge.style.display = hasNew ? 'block' : 'none';
    }
    updateGlobalBadge();

    // --- ë¦¬ë·° í˜ì´ì§€ë„¤ì´ì…˜ ---
    const REVIEWS_PER_PAGE = 10;
    let currentPage = 1;
    let MOCK_ALL_REVIEWS = [];

    function generateMockReviews() {
        const reviews = [];
        const names = ["ìº¡í‹´ì†", "í’‹ì‚´ë§¤ë‹ˆì•„", "ìƒˆ ë¦¬ë·°ì–´", "ì¶•êµ¬ì‚¬ë‘", "ë‹¬ë¦¬ê¸°ì™•", "í‚¤í¼ì§±", "ìŠ¤íŠ¸ë¼ì´ì»¤K"];
        const contents = [
            "êµ¬ì¥ ìƒíƒœê°€ ë§¤ìš° ê¹¨ë—í•˜ê³  ì”ë”” ì»¨ë””ì…˜ì´ ìµœê³ ì…ë‹ˆë‹¤.",
            "ìƒ¤ì›Œ ì‹œì„¤ì´ ì˜ ë˜ì–´ ìˆì–´ì„œ í‡´ê·¼ í›„ ë°”ë¡œ ê²½ê¸°í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤. ì¡°ëª…ë„ ë°ì•„ì„œ ì•¼ê°„ ê²½ê¸°í•˜ê¸° ì¢‹ì•„ìš”.",
            "ì´ˆë³´ìì—ê²Œ ì í•©í•œ ë ˆë²¨ì˜ ë§¤ì¹­ì´ ë§ì•„ì„œ ë¶€ë‹´ ì—†ì´ ì¦ê¸¸ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤! ìœ„ì¹˜ë„ ì¢‹ìŠµë‹ˆë‹¤.",
            "ì£¼ì°¨ ê³µê°„ì´ ì¡°ê¸ˆ ì¢ì€ ê²ƒì´ í ì´ì§€ë§Œ, ê°€ì„±ë¹„ê°€ ì¢‹ì•„ìš”.",
            "ê´€ë¦¬ìë¶„ì´ ì¹œì ˆí•˜ì…”ì„œ ê¸°ë¶„ ì¢‹ê²Œ ìš´ë™í–ˆìŠµë‹ˆë‹¤.",
            "ë‹¤ìŒì—ë„ ê¼­ ì´ìš©í•˜ê³  ì‹¶ì€ êµ¬ì¥ì…ë‹ˆë‹¤. ì¶”ì²œ!",
            "ì”ë””ê°€ ì•½ê°„ ë”±ë”±í•œ ê°ì´ ìˆì§€ë§Œ, ì „ì²´ì ìœ¼ë¡œ ë§Œì¡±í•©ë‹ˆë‹¤."
        ];

        for (let i = 1; i <= 12; i++) {
            reviews.push({
                id: i,
                user: names[i % names.length],
                date: `2025-10-${String(10 + i).padStart(2, '0')}`,
                content: contents[i % contents.length] + ` (Review #${i})`,
                rating: (i % 5) + 1
            });
        }
        return reviews;
    }

    function renderReviews(page) {
        currentPage = page;
        const listContainer = document.getElementById('review-list');
        const totalReviews = MOCK_ALL_REVIEWS.length;
        const CURRENT_USER_NICKNAME = "ìƒˆ ë¦¬ë·°ì–´";

        const startIndex = (page - 1) * REVIEWS_PER_PAGE;
        const endIndex = startIndex + REVIEWS_PER_PAGE;
        const reviewsToDisplay = MOCK_ALL_REVIEWS.slice(startIndex, endIndex);

        listContainer.innerHTML = '';

        if (totalReviews === 0) {
            listContainer.innerHTML = '<p style="text-align: center; color: #999; padding: 50px;">ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            document.getElementById('review-count').textContent = 0;
            document.getElementById('pagination-controls').style.display = 'none';
            return;
        }

        reviewsToDisplay.forEach(review => {
            const item = document.createElement('div');
            item.className = 'review-item';

            const isMyReview = review.user === CURRENT_USER_NICKNAME;
            let actionButtonsHtml = '';

            if (isMyReview) {
                actionButtonsHtml = `
                    <div class="review-actions">
                        <button onclick="handleReviewEdit(${review.id})">ìˆ˜ì •</button>
                        <button class="delete" onclick="handleReviewDelete(${review.id})">ì‚­ì œ</button>
                    </div>
                `;
            }

            const starRatingHtml = review.rating
                ? `<span class="star-display">${'â˜…'.repeat(review.rating)}</span>`
                : '';

            item.innerHTML = `
                <div class="review-header">
                    <span class="review-user">${starRatingHtml} ${review.user} ${isMyReview ? '(ë‚˜)' : ''}</span>
                    <span class="review-date">${review.date}</span>
                </div>
                <p class="review-content">${review.content}</p>
                ${actionButtonsHtml}
            `;
            listContainer.appendChild(item);
        });

        document.getElementById('review-count').textContent = totalReviews;
        renderPagination(totalReviews, page);
    }

    function renderPagination(totalReviews, currentPage) {
        const totalPages = Math.ceil(totalReviews / REVIEWS_PER_PAGE);
        const controls = document.getElementById('pagination-controls');
        const pageNumbersContainer = document.getElementById('page-numbers');
        const prevButton = document.getElementById('prev-page');
        const nextButton = document.getElementById('next-page');

        if (totalPages <= 1) {
            controls.style.display = 'none';
            return;
        }

        controls.style.display = 'block';
        pageNumbersContainer.innerHTML = '';

        const pagesPerGroup = 5;
        const currentGroup = Math.ceil(currentPage / pagesPerGroup);
        const startPage = (currentGroup - 1) * pagesPerGroup + 1;
        const endPage = Math.min(startPage + pagesPerGroup - 1, totalPages);

        for (let i = startPage; i <= endPage; i++) {
            const pageButton = document.createElement('button');
            pageButton.textContent = i;
            pageButton.className = i === currentPage ? 'active' : '';
            pageButton.onclick = () => renderReviews(i);
            pageNumbersContainer.appendChild(pageButton);
        }

        prevButton.disabled = currentPage === 1;
        nextButton.disabled = currentPage === totalPages;

        prevButton.onclick = () => {
            if (currentPage > 1) renderReviews(currentPage - 1);
        };
        nextButton.onclick = () => {
            if (currentPage < totalPages) renderReviews(currentPage + 1);
        };
    }

    function handleReviewEdit(reviewId) {
        const reviewIndex = MOCK_ALL_REVIEWS.findIndex(r => r.id === reviewId);
        if (reviewIndex !== -1) {
            const currentContent = MOCK_ALL_REVIEWS[reviewIndex].content;
            const currentRating = MOCK_ALL_REVIEWS[reviewIndex].rating;

            const newContent = prompt(`ë¦¬ë·° ë‚´ìš©ì„ ìˆ˜ì •í•´ì£¼ì„¸ìš” (í˜„ì¬ ë³„ì : ${currentRating}ì ):`, currentContent);

            if (newContent !== null && newContent.trim() !== "" && newContent.trim() !== currentContent.trim()) {
                MOCK_ALL_REVIEWS[reviewIndex].content = newContent.trim() + " (ìˆ˜ì •ë¨)";

                const stadiumId = new URLSearchParams(window.location.search).get('id') || '1';
                let localReviews = JSON.parse(localStorage.getItem(`reviews_${stadiumId}`)) || [];

                const localIndex = localReviews.findIndex(r => r.id === reviewId);
                if (localIndex !== -1) {
                    localReviews[localIndex].content = MOCK_ALL_REVIEWS[reviewIndex].content;
                    localReviews[localIndex].rating = currentRating;
                }
                localStorage.setItem(`reviews_${stadiumId}`, JSON.stringify(localReviews));

                renderReviews(currentPage);
                alert("âœ… ë¦¬ë·°ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
            } else if (newContent !== null && newContent.trim() !== "") {
                alert("ìˆ˜ì •ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.");
            }
        }
    }

    function handleReviewDelete(reviewId) {
        if (confirm("ì •ë§ë¡œ ì´ ë¦¬ë·°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            MOCK_ALL_REVIEWS = MOCK_ALL_REVIEWS.filter(r => r.id !== reviewId);

            const stadiumId = new URLSearchParams(window.location.search).get('id') || '1';
            let localReviews = JSON.parse(localStorage.getItem(`reviews_${stadiumId}`)) || [];
            localReviews = localReviews.filter(r => r.id !== reviewId);
            localStorage.setItem(`reviews_${stadiumId}`, JSON.stringify(localReviews));

            renderReviews(1);
            alert("âœ… ë¦¬ë·°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        }
    }

    window.handleReviewEdit = handleReviewEdit;
    window.handleReviewDelete = handleReviewDelete;

    // ê²½ê¸° ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
    function openMatchModal(isOpen) {
        const modal = document.getElementById('match-create-modal');
        if (!modal) return;
        if (isOpen) {
            modal.classList.add('show');
        } else {
            modal.classList.remove('show');
        }
    }

    // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ì „ì²´ ê²½ê¸°
    function getLocalMatches() {
        try {
            return JSON.parse(localStorage.getItem('match_schedules')) || [];
        } catch (e) {
            console.error("match_schedules íŒŒì‹± ì˜¤ë¥˜:", e);
            localStorage.removeItem('match_schedules');
            return [];
        }
    }

    // âœ… íŠ¹ì • êµ¬ì¥ + ë‚ ì§œì— ëŒ€í•œ ê²½ê¸° ëª©ë¡ ë Œë”ë§ (ì¸ì› â†’ ëª¨ì§‘ì¤‘/ë§ˆê°ìœ¼ë¡œ ë³€ê²½)
    function renderMatchList(stadiumId, dateStr) {
        const listEl = document.getElementById('match-list');
        if (!listEl) return;

        listEl.innerHTML = '';

        if (!dateStr) {
            listEl.innerHTML = `<p style="color:#777; font-size:13px; padding:10px 0;">
                ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´, ì´ êµ¬ì¥ì—ì„œ ì§„í–‰ ì˜ˆì •ì¸ ê²½ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤.
            </p>`;
            return;
        }

        const all = getLocalMatches();
        const filtered = all
            .filter(m => String(m.stadiumId) === String(stadiumId) && m.date === dateStr)
            .sort((a, b) => a.startTime.localeCompare(b.startTime));

        if (filtered.length === 0) {
            listEl.innerHTML = `<p style="color:#777; font-size:13px; padding:10px 0;">
                ì„ íƒí•œ ë‚ ì§œì— ë“±ë¡ëœ ê²½ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.
            </p>`;
            return;
        }

        filtered.forEach(match => {
            const item = document.createElement('div');
            item.className = 'match-item';

            // ğŸ”¥ ìƒíƒœ ê³„ì‚°: status === 'closed' ì´ê±°ë‚˜ current/max ê½‰ ì°¼ìœ¼ë©´ ë§ˆê°
            const current = match.current ?? 1;
            const max = match.max ?? 10;
            const isClosed = (match.status === 'closed') || (current >= max);
            const statusText = isClosed ? 'ë§ˆê°' : 'ëª¨ì§‘ì¤‘';
            const statusClass = isClosed ? 'closed' : 'open';

            item.innerHTML = `
                <div class="match-item-time">${match.startTime} ~ ${match.endTime}</div>
                <div class="match-item-meta">
                    ì£¼ìµœì: ${match.creator || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                    Â·
                    <span class="match-status ${statusClass}">${statusText}</span>
                </div>
            `;
            item.addEventListener('click', () => {
                window.location.href = '/schedule/detail/' + match.id;
            });
            listEl.appendChild(item);
        });
    }

    // ê²½ê¸° ìƒì„± ì œì¶œ ë¡œì§
    function submitMatchForm() {
        const stadiumId = new URLSearchParams(window.location.search).get('id') || '1';
        const stadiumNameInput = document.getElementById('stadiumName');
        const hostNameInput = document.getElementById('hostName');
        const matchDateInput = document.getElementById('matchDate');
        const startTimeSelect = document.getElementById('startTime');
        const endTimeSelect = document.getElementById('endTime');

        const matchDate = matchDateInput.value;
        const startTime = startTimeSelect.value;
        const endTime = endTimeSelect.value;

        if (!stadiumId || stadiumNameInput.value.includes("ì •ë³´ ì—†ìŒ")) {
            alert("âŒ ê²½ê¸° ê°œì„¤ì„ ìœ„í•´ì„œëŠ” ìœ íš¨í•œ êµ¬ì¥ì„ ë¨¼ì € ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.");
            return;
        }
        if (!matchDate) {
            alert("âŒ ê²½ê¸° ë‚ ì§œë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
            return;
        }
        if (startTime >= endTime) {
            alert("âŒ ì‹œì‘ ì‹œê°„ì€ ì¢…ë£Œ ì‹œê°„ë³´ë‹¤ ë¹¨ë¼ì•¼ í•©ë‹ˆë‹¤.");
            return;
        }

        const startDateTimeStr = `${matchDate}T${startTime}`;
        const currentDateTimeStr = new Date().toISOString().slice(0, 16);
        if (startDateTimeStr < currentDateTimeStr) {
            alert("âŒ ì´ë¯¸ ì§€ë‚œ ë‚ ì§œë‚˜ ì‹œê°„ìœ¼ë¡œëŠ” ê²½ê¸°ë¥¼ ê°œì„¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        const NEW_MATCH_ID = Date.now();
        const newMatchData = {
            id: NEW_MATCH_ID,
            stadiumId: stadiumId,
            date: matchDate,
            startTime: startTime,
            endTime: endTime,
            location: stadiumNameInput.value,
            creator: hostNameInput.value,
            current: 1,
            max: 10,
            status: "open",
            type: "íŒ€ ë§¤ì¹­"
        };

        let localMatchSchedules = getLocalMatches();
        localMatchSchedules.unshift(newMatchData);
        localStorage.setItem('match_schedules', JSON.stringify(localMatchSchedules));

        // ê°œì¸ ì¼ì •ì—ë„ ì¶”ê°€
        const newCalendarEvent = {
            id: NEW_MATCH_ID,
            title: `${stadiumNameInput.value} ê²½ê¸°`,
            date: matchDate,
            time: `${startTime} ~ ${endTime}`,
            type: "match",
            matchId: NEW_MATCH_ID,
            location: stadiumNameInput.value
        };
        let personalSchedules = JSON.parse(localStorage.getItem('personalSchedules')) || [];
        personalSchedules.push(newCalendarEvent);
        localStorage.setItem('personalSchedules', JSON.stringify(personalSchedules));

        localStorage.setItem('calendarUpdated', 'true');

        alert(`'${newMatchData.location}' ê²½ê¸°ê°€ ì„±ê³µì ìœ¼ë¡œ ê°œì„¤ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        openMatchModal(false);

        const matchDateFilterInput = document.getElementById('match-date-filter');
        if (matchDateFilterInput) {
            if (!matchDateFilterInput.value) {
                matchDateFilterInput.value = matchDate;
            }
            renderMatchList(stadiumId, matchDateFilterInput.value);
        }
    }

    // DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const stadiumId = urlParams.get('id') || '1';

        const tabBtnMatch = document.getElementById('tab-btn-match');
        const tabBtnReview = document.getElementById('tab-btn-review');
        const tabMatch = document.getElementById('tab-match');
        const tabReview = document.getElementById('tab-review');

        function activateTab(tabName) {
            if (tabName === 'match') {
                tabBtnMatch.classList.add('active');
                tabBtnReview.classList.remove('active');
                tabMatch.classList.add('active');
                tabReview.classList.remove('active');
            } else {
                tabBtnMatch.classList.remove('active');
                tabBtnReview.classList.add('active');
                tabMatch.classList.remove('active');
                tabReview.classList.add('active');
            }
        }

        if (tabBtnMatch && tabBtnReview) {
            tabBtnMatch.addEventListener('click', () => activateTab('match'));
            tabBtnReview.addEventListener('click', () => activateTab('review'));
        }
        activateTab('match');

        const DUMMY_DATA = {
            name: "ê°•ë‚¨ í’‹ì‚´ ì•„ë ˆë‚˜",
            address: "ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123",
            contact: "02-1234-5678",
            fee: "50,000ì›/ì‹œê°„",
            size: "5 vs 5"
        };

        document.getElementById('stadium-name').textContent = `${DUMMY_DATA.name} (ID: ${stadiumId})`;
        document.getElementById('stadium-address').textContent = DUMMY_DATA.address;
        document.getElementById('stadium-contact').textContent = DUMMY_DATA.contact;
        document.getElementById('stadium-fee').textContent = DUMMY_DATA.fee;
        document.getElementById('stadium-size').textContent = DUMMY_DATA.size;

        let baseReviews = generateMockReviews();
        const localReviews = JSON.parse(localStorage.getItem(`reviews_${stadiumId}`)) || [];
        const allReviews = [...localReviews, ...baseReviews];
        const uniqueReviews = allReviews.reduce((acc, review) => {
            if (!acc.some(r => r.id === review.id)) {
                acc.push(review);
            }
            return acc;
        }, []);
        MOCK_ALL_REVIEWS = uniqueReviews;
        renderReviews(currentPage);

        document.getElementById('btn-schedule').href = `/schedule?stadiumId=${stadiumId}`;
        document.getElementById('btn-create-match').href = `/match/create?stadiumId=${stadiumId}`;

        const accessToken = localStorage.getItem('accessToken');
        if (accessToken) {
            document.getElementById('profile-menu-toggle').style.display = 'block';
        }

        const btnCreateMatch = document.getElementById('btn-create-match');
        const DEFAULT_USER = "ë¡œê·¸ì¸ ì‚¬ìš©ì";
        const hostNameInput = document.getElementById('hostName');
        const stadiumNameInput = document.getElementById('stadiumName');
        const hiddenStadiumIdInput = document.getElementById('stadiumId');
        const matchDateInput = document.getElementById('matchDate');
        const startTimeSelect = document.getElementById('startTime');
        const endTimeSelect = document.getElementById('endTime');

        function populateTimeSelects() {
            startTimeSelect.innerHTML = '';
            endTimeSelect.innerHTML = '';

            for (let i = 0; i <= 23; i++) {
                const timeStr = String(i).padStart(2, '0') + ':00';
                startTimeSelect.innerHTML += `<option value="${timeStr}">${timeStr}</option>`;
            }
            for (let i = 1; i <= 24; i++) {
                const timeStr = String(i).padStart(2, '0') + ':00';
                endTimeSelect.innerHTML += `<option value="${timeStr}">${timeStr}</option>`;
            }

            startTimeSelect.value = "19:00";
            endTimeSelect.value = "20:00";
        }

        function setupDateFieldForModal() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            const todayDateStr = `${yyyy}-${mm}-${dd}`;
            matchDateInput.value = todayDateStr;
            matchDateInput.min = todayDateStr;
        }

        function initMatchModalFields() {
            hostNameInput.value = DEFAULT_USER;

            const fullNameText = document.getElementById('stadium-name').textContent;
            const pureName = fullNameText.split('(ID')[0].trim();
            stadiumNameInput.value = pureName || "êµ¬ì¥ ì •ë³´ ì—†ìŒ";
            hiddenStadiumIdInput.value = stadiumId;

            populateTimeSelects();
            setupDateFieldForModal();
        }

        if (btnCreateMatch) {
            btnCreateMatch.addEventListener('click', (e) => {
                e.preventDefault();

                const accessToken = localStorage.getItem('accessToken');
                if (!accessToken) {
                    alert("âŒ íšŒì› ì „ìš© ê¸°ëŠ¥ì…ë‹ˆë‹¤.\në¡œê·¸ì¸ í›„ ì´ìš©í•´ ì£¼ì„¸ìš”.");
                    window.location.href = '/login';
                    return;
                }

                initMatchModalFields();
                openMatchModal(true);
            });
        }

        const matchDateFilterInput = document.getElementById('match-date-filter');
        if (matchDateFilterInput) {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            const todayDateStr = `${yyyy}-${mm}-${dd}`;

            matchDateFilterInput.value = todayDateStr;
            matchDateFilterInput.min = todayDateStr;

            renderMatchList(stadiumId, todayDateStr);

            matchDateFilterInput.addEventListener('change', () => {
                renderMatchList(stadiumId, matchDateFilterInput.value);
            });
        }

        const matchModal = document.getElementById('match-create-modal');
        if (matchModal) {
            matchModal.addEventListener('click', (e) => {
                if (e.target === matchModal) {
                    openMatchModal(false);
                }
            });
        }
    });
</script>

</body>
</html>
