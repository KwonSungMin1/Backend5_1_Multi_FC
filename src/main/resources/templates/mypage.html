<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi FC - ë§ˆì´í˜ì´ì§€</title>

    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&family=Noto+Sans+KR:wght[400;700]&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ (ìƒëµ) */
        .info-view-group { margin-bottom: 20px; }
        .info-view-group label { display: block; font-weight: 700; margin-bottom: 6px; color: #2c3e50; font-size: 14px; }
        .info-view-text { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; background: #f7f7f7; color: #333; min-height: 47px; box-sizing: border-box; display: flex; align-items: center; }
        .info-view-profile-pic { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid #eee; margin-bottom: 15px; }

        /* --- ì¹œêµ¬ ê´€ë¦¬ íƒ­ ìŠ¤íƒ€ì¼ --- */
        .tab-buttons.sub-tabs { display: flex; margin-bottom: 20px; border-bottom: 1px solid #eee; }
        .tab-buttons.sub-tabs .sub-tab-btn { flex-grow: 1; padding: 10px 15px; background-color: #f0f0f0; border: 1px solid #ddd; border-bottom: none; border-radius: 8px 8px 0 0; cursor: pointer; font-size: 15px; color: #555; transition: all 0.2s ease; margin-right: 5px; text-align: center; }
        .tab-buttons.sub-tabs .sub-tab-btn.active { background-color: #6c5ce7; color: white; border-color: #6c5ce7; position: relative; top: 1px; z-index: 1; }
        .sub-tab-content { display: none; padding: 20px 0; border-top: 1px solid #eee; }
        .sub-tab-content.active { display: block; }

        /* ì¹œêµ¬ ê²€ìƒ‰ ê·¸ë£¹ (ì¹œêµ¬ ëª©ë¡ íƒ­) */
        .friend-list-search-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .friend-list-search-group input { flex-grow: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .friend-list-search-group button { padding: 10px 15px; background-color: #6c5ce7; color: white; border: none; border-radius: 5px; cursor: pointer; }

        /* ì¹œêµ¬ ëª©ë¡ ì•„ì´í…œ */
        .friend-item-list { list-style: none; padding: 0; margin: 0; }
        .friend-item-list li {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 10px;
            background-color: #fdfdfd;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03);
            font-size: 16px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: background-color 0.2s ease;
        }
        .friend-item-list li:hover {
            background-color: #f0f0f0;
        }
        .friend-item-list li.active {
            background-color: #e6e6ff;
            border-color: #6c5ce7;
        }
        .friend-item-list li strong {
            flex-grow: 1;
            color: #333;
            margin-right: 150px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .action-buttons {
            display: none;
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            gap: 8px;
            background-color: inherit;
            padding-left: 10px;
            z-index: 10;
        }
        .friend-item-list li.active .action-buttons {
            display: flex;
        }
        .action-buttons button {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            white-space: nowrap;
            transition: background-color 0.2s ease;
        }
        .action-buttons .btn-chat {
            background-color: #4a90e2;
            color: white;
        }
        .action-buttons .btn-delete {
            background-color: #ff7675;
            color: white;
        }

        /* ì¹œêµ¬ ì¶”ê°€ íƒ­ ìŠ¤íƒ€ì¼ (ê¸°ì¡´ ìœ ì§€) */
        .friend-add-search-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .friend-add-search-group input { flex-grow: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .friend-add-search-group button { padding: 10px 15px; background-color: #6c5ce7; color: white; border: none; border-radius: 5px; cursor: pointer; }

        /* â­â­â­ ì¹œêµ¬ ìš”ì²­ ëª©ë¡ ì•„ì´í…œ ìŠ¤íƒ€ì¼ (í´ë¦­ ê°€ëŠ¥ ì˜ì—­) â­â­â­ */
        .friend-request-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 10px;
            background-color: #fdfdfd;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03);
            font-size: 16px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: background-color 0.2s ease;
            list-style: none;
        }
        .friend-request-item:hover {
            background-color: #f0f0f0;
        }
        .friend-request-item.active {
            background-color: #e6e6ff; /* í™œì„±í™” ë°°ê²½ìƒ‰ */
            border-color: #6c5ce7;
        }

        /* ìš”ì²­ ì•¡ì…˜ ë²„íŠ¼ ê·¸ë£¹ (í† ê¸€) */
        .request-actions {
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            gap: 8px;
            z-index: 10;
        }
        .friend-request-item.active .request-actions {
            display: flex; /* active ì‹œ í‘œì‹œ */
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .request-actions button {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: white;
            white-space: nowrap;
        }
        .request-actions .btn-accept { background-color: #2ecc71; } /* ìˆ˜ë½: ë…¹ìƒ‰ */
        .request-actions .btn-reject { background-color: #e74c3c; } /* ê±°ì ˆ: ë¹¨ê°„ìƒ‰ */


        .friend-add-actions .btn-add-selected { padding: 10px 20px; background-color: #2ecc71; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; }

        /* â­â­â­ ë§ˆì´í˜ì´ì§€ ê³ ìœ  ìŠ¤íƒ€ì¼ (ìœ ì§€) â­â­â­ */
        .score-display {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            padding: 15px;
            background: rgba(230, 230, 255, 0.9); /* ë°°ê²½ íˆ¬ëª…ë„ ì¡°ì • */
            border-radius: 10px;
            overflow: hidden;
            backdrop-filter: blur(3px);
            -webkit-backdrop-filter: blur(3px);
        }
        .score-item {
            text-align: center;
            font-size: 14px;
            color: #2c3e50;
            width: 50%;
            padding: 10px 10px;
            position: relative;
        }
        .score-item:first-child {
            background-color: rgba(108, 92, 231, 0.05);
            border-right: 1px solid #c0c0e0;
            border-radius: 8px 0 0 8px;
        }
        .score-item:last-child {
            background-color: rgba(46, 204, 113, 0.05);
            border-radius: 0 8px 8px 0;
            border-right: none;
        }
        .score-item .icon-box {
            font-size: 30px;
            color: #6c5ce7;
            margin-bottom: 5px;
            display: block;
        }
        .score-item strong {
            display: block;
            font-size: 24px;
            font-weight: 800;
            color: #2c3e50;
            margin-top: 5px;
        }

        /* ìº˜ë¦°ë” ì´ë²¤íŠ¸ ìŠ¤íƒ€ì¼: ê²½ê¸°ì¼ì •/ê°œì¸ì¼ì • êµ¬ë¶„ */
        .calendar-event.match-schedule {
            background-color: rgba(144, 77, 240, 0.7);
            border-left: 3px solid #9461e7;
            color: white;
            padding: 2px 4px;
            margin-top: 2px;
            font-size: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            border-radius: 3px;
            cursor: pointer;
        }

        /* ê°œì¸ ì¼ì • (Personal Schedule): íŒŒë€ìƒ‰ ê³„ì—´ */
        .calendar-event.personal-schedule {
            background-color: rgba(74, 144, 226, 0.7);
            border-left: 3px solid #4a90e2;
            color: white;
            padding: 2px 4px;
            margin-top: 2px;
            font-size: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            border-radius: 3px;
            cursor: pointer;
        }

        /* ë‹¬ë ¥ ì¹¸ ë†’ì´ ì¦ê°€ (ê¸€ì”¨ ê¹¨ì§/ë‘ ì¤„ í‘œì‹œ í•´ê²°) */
        .calendar-day-cell {
            height: 100px;
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 8px;
            font-size: 14px;
            font-weight: 600;
            background-color: rgba(255, 255, 255, 0.85); /* ë‹¬ë ¥ ì…€ ë°°ê²½ íˆ¬ëª…ë„ ì¡°ì • */
            transition: background-color 0.3s;
            cursor: pointer;
            backdrop-filter: blur(2px);
            -webkit-backdrop-filter: blur(2px);
        }
        .calendar-day-cell.today {
            border: 2px solid #ff7675;
            border-radius: 8px;
            background-color: rgba(255, 234, 234, 0.9); /* ì˜¤ëŠ˜ ë‚ ì§œ ë°°ê²½ íˆ¬ëª…ë„ ì¡°ì • */
            font-weight: bold;
        }
        /* [ë³µêµ¬ ë° ì¡°ì •]: ë§ˆì´í˜ì´ì§€ ì»¨í…Œì´ë„ˆ ë„ˆë¹„ë¥¼ ë³µêµ¬í•˜ê³ , ì´ë¯¸ì§€ ì œê±°ì— ë§ì¶° íŒ¨ë”© ì¡°ì • */
        .login-section#full-width-section {
            flex: 1 1 100%;
            max-width: 100%;
            padding-right: 30px !important;
        }

        /* [ë³µêµ¬]: main-wrapperì˜ Flexbox ë ˆì´ì•„ì›ƒì„ ìœ ì§€í•©ë‹ˆë‹¤. */
        .main-wrapper {
            width: 1000px;
            max-width: 95%;
        }

        /* ì¹œêµ¬ ê´€ë¦¬ ì œëª© ìŠ¤íƒ€ì¼ ë° ì•„ì´ì½˜ ë°°ì¹˜ */
        .friends-management-title-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .friends-management-title-wrapper h3 {
            margin: 0;
            font-size: 24px;
            color: #2c3e50;
        }
        .friends-add-icon-btn {
            background: none;
            border: none;
            color: #6c5ce7;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            line-height: 1;
        }

        /* ìº˜ë¦°ë” ìƒì„¸ ì°½ (íŒì—… ëŒ€ì‹  ê³ ì • ì˜ì—­ìœ¼ë¡œ ì‚¬ìš©) ìŠ¤íƒ€ì¼ */
        .fixed-schedule-list li {
            padding: 8px 10px;
            margin-bottom: 8px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .fixed-schedule-list li:hover {
            opacity: 0.9;
        }
        .fixed-schedule-list li.active {
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
            border: 1px solid #fff;
        }
        /* [ìˆ˜ì •] ì¼ì • ëª©ë¡ ë°°ê²½ìƒ‰ íˆ¬ëª…ë„ ì¡°ì • */
        .fixed-schedule-list li.match-schedule { background-color: rgba(148, 97, 231, 0.85); color: white; } /* 85% ë¶ˆíˆ¬ëª…ë„ */
        .fixed-schedule-list li.personal-schedule { background-color: rgba(74, 144, 226, 0.85); color: white; } /* 85% ë¶ˆíˆ¬ëª…ë„ */

        /* ìº˜ë¦°ë” íƒ­ ë ˆì´ì•„ì›ƒ ì¡°ì • CSS */
        .calendar-layout-wrapper {
            display: flex;
            gap: 20px;
            flex-wrap: nowrap;
        }

        /* ìº˜ë¦°ë” ì»¨í…Œì´ë„ˆì˜ ë„ˆë¹„ë¥¼ ì œí•œí•˜ì—¬ ìƒì„¸ ì°½ì´ ë“¤ì–´ê°ˆ ê³µê°„ì„ ë§Œë“­ë‹ˆë‹¤ */
        .calendar-container {
            flex-grow: 1;
            max-width: none;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            background: rgba(255, 255, 255, 0.85); /* ìº˜ë¦°ë” ì»¨í…Œì´ë„ˆ ë°°ê²½ë„ íˆ¬ëª…ë„ ì¡°ì • */
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(3px);
            -webkit-backdrop-filter: blur(3px);
        }

        /* ìº˜ë¦°ë” ê·¸ë¦¬ë“œ ì…€ í¬ê¸° ì•ˆì •í™” */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        /* ìº˜ë¦°ë” í—¤ë” ê·¸ë¦¬ë“œì—ë„ ë™ì¼í•œ ê°„ê²© ì ìš© */
        #calendar-days-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }

        .calendar-header-cell {
            text-align: center;
            font-weight: bold;
            padding: 10px 0;
            color: #555;
            background-color: rgba(248, 248, 248, 0.9); /* ìº˜ë¦°ë” í—¤ë” ì…€ ë°°ê²½ìƒ‰ ì¡°ì • */
            border-radius: 5px;
        }

        /* â­ [í•µì‹¬ ìˆ˜ì •] ìº˜ë¦°ë” ìƒì„¸ ì°½ ë°°ê²½ íˆ¬ëª…ë„ ë° ë¸”ëŸ¬ íš¨ê³¼ ì ìš© â­ */
        #fixed-schedule-detail {
            width: 300px;
            flex-shrink: 0;
            position: relative !important;
            top: auto !important;
            left: auto !important;
            transform: none !important;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            background: transparent; /* ë°°ê²½ì„ ì™„ì „íˆ íˆ¬ëª…í•˜ê²Œ ì„¤ì • */
            border: 1px solid rgba(221, 221, 221, 0.5); /* í…Œë‘ë¦¬ë„ íˆ¬ëª…ë„ ì¡°ì • */
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(8px); /* ë’¤ ë°°ê²½ì„ ê°•í•˜ê²Œ íë¦¬ê²Œ */
            -webkit-backdrop-filter: blur(8px); /* ì‚¬íŒŒë¦¬ ì§€ì› */
        }

        /* ë‹«ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #close-detail-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            font-size: 20px;
            color: #999;
            cursor: pointer;
            line-height: 1;
            z-index: 10;
            padding: 5px;
        }

        /* â­ [ì¶”ê°€] ì…ë ¥ í•„ë“œ ë° ë²„íŠ¼ ë°°ê²½ íˆ¬ëª…ë„ ì¡°ì • â­ */
        #fixed-detail-edit-area {
            border: 1px solid rgba(221, 221, 221, 0.5); /* í…Œë‘ë¦¬ íˆ¬ëª…ë„ ì¡°ì • */
            padding: 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.7); /* í¸ì§‘ ì˜ì—­ ë°°ê²½ 70% ë¶ˆíˆ¬ëª…ë„ */
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); /* ê·¸ë¦¼ì ì¶”ê°€ */
        }
        #selected-schedule-time,
        #selected-schedule-name,
        #selected-schedule-content {
            background-color: rgba(255, 255, 255, 0.8); /* ì…ë ¥ í•„ë“œ ë°°ê²½ 80% ë¶ˆíˆ¬ëª…ë„ */
            border: 1px solid rgba(221, 221, 221, 0.7);
            color: #333;
        }
        #save-schedule-btn, #delete-schedule-btn {
            background-color: rgba(204, 204, 204, 0.7); /* ë¹„í™œì„±í™” ë²„íŠ¼ ë°°ê²½ 70% ë¶ˆíˆ¬ëª…ë„ */
            color: white; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ ëª…í™•íˆ */
            border: none;
        }
        /* JSì—ì„œ ì„¤ì •í•˜ëŠ” í™œì„±í™” ë°°ê²½ìƒ‰ë„ íˆ¬ëª…ë„ ì¡°ì •ì´ í•„ìš” */
        #save-schedule-btn[data-mode="add"]:not([disabled]) { /* ë“±ë¡ ë²„íŠ¼ í™œì„±í™” */
            background-color: rgba(46, 204, 113, 0.85) !important; /* ë“±ë¡ ë²„íŠ¼ í™œì„±í™” 85% */
        }
        #save-schedule-btn[data-mode="edit"]:not([disabled]) { /* ìˆ˜ì • ë²„íŠ¼ í™œì„±í™” */
            background-color: rgba(74, 144, 226, 0.85) !important; /* ì €ì¥ ë²„íŠ¼ í™œì„±í™” 85% */
        }
        #delete-schedule-btn:not([disabled]) {
            background-color: rgba(231, 76, 60, 0.85) !important; /* ì‚­ì œ ë²„íŠ¼ í™œì„±í™” 85% */
        }

        /* â­ [ì¶”ê°€] íƒ­ ì»¨í…ì¸  ë°°ê²½ íˆ¬ëª…ë„ ì¡°ì • â­ */
        .tab-content {
            background: white; /* íƒ­ ì»¨í…ì¸  ë°°ê²½ í°ìƒ‰ìœ¼ë¡œ ë³µêµ¬ */
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
        }

        /* ìº˜ë¦°ë” íƒ­ ì»¨í…ì¸ ë§Œ íˆ¬ëª… ìœ ì§€ */
        #tab-calendar {
            background: transparent;
            box-shadow: none;
        }

        .login-container {
            background: rgba(255, 255, 255, 0.9); /* ë¡œê·¸ì¸ ì»¨í…Œì´ë„ˆ ë°°ê²½ë„ íˆ¬ëª…ë„ ì¡°ì • */
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px); /* ë¡œê·¸ì¸ ì»¨í…Œì´ë„ˆ ìì²´ì— ë¸”ëŸ¬ ì ìš© */
            -webkit-backdrop-filter: blur(10px);
        }

        /* ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´ ìŠ¤íƒ€ì¼ (í† ê¸€ ë©”ë‰´) */
        .main-menu {
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            position: absolute;
            top: 60px; /* í—¤ë” ë†’ì´ì— ë§ê²Œ ì¡°ì • */
            right: 0;
            background-color: rgba(255, 255, 255, 0.95); /* ë°˜íˆ¬ëª… í°ìƒ‰ */
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
            z-index: 1000;
            min-width: 180px;
            padding: 10px 0;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .main-menu.show {
            display: block; /* 'show' í´ë˜ìŠ¤ ìˆì„ ë•Œ í‘œì‹œ */
        }

        .main-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .main-menu li a {
            display: block;
            padding: 12px 20px;
            color: #333;
            text-decoration: none;
            font-size: 15px;
            transition: background-color 0.2s ease, color 0.2s ease, border-left 0.2s ease, padding-left 0.2s ease;
            font-weight: 600 !important; /* â­ êµµê²Œ ì„¤ì • â­ */
        }

        /* â­â­â­ [í•µì‹¬ ìˆ˜ì •] í–„ë²„ê±° ë©”ë‰´ í•˜ì´ë¼ì´íŠ¸ ìŠ¤íƒ€ì¼ í†µì¼ â­â­â­ */
        .main-menu li a:hover, .main-menu li a.active {
            background-color: rgba(108, 92, 231, 0.1);
            color: #6c5ce7;
            border-left: 4px solid #6c5ce7;
            padding-left: 16px;
        }
        .main-menu li a i {
            margin-right: 10px;
            color: #999;
        }
        .main-menu li a:hover i, .main-menu li a.active i {
            color: #6c5ce7;
        }

        /* í”„ë¡œí•„ ë©”ë‰´ ìŠ¤íƒ€ì¼ (ê¸°ì¡´ ìœ ì§€) */
        .user-menu {
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            position: absolute;
            top: 60px; /* í—¤ë” ë†’ì´ì— ë§ê²Œ ì¡°ì • */
            right: 10px;
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
            z-index: 1000;
            min-width: 200px;
            padding: 10px 0;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .user-menu.show {
            display: block;
        }

        .user-menu .user-info {
            padding: 10px 20px;
            border-bottom: 1px solid #eee;
            margin-bottom: 10px;
            text-align: center;
        }

        .user-menu .user-info strong {
            display: block;
            font-size: 16px;
            color: #333;
            margin-bottom: 5px;
        }

        .user-menu .user-info p {
            font-size: 13px;
            color: #777;
            margin: 0;
        }

        .user-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .user-menu li a {
            display: block;
            padding: 12px 20px;
            color: #333;
            text-decoration: none;
            font-size: 15px;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .user-menu li a:hover {
            background-color: #f0f0f0;
            color: #6c5ce7;
        }

        .user-menu li a i {
            margin-right: 10px;
            color: #999;
        }
        .user-menu li a:hover i {
            color: #6c5ce7;
        }

        /* ìº˜ë¦°ë” í—¤ë” ë°°ê²½ìƒ‰ */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            background-color: rgba(248, 248, 248, 0.8); /* ìº˜ë¦°ë” í—¤ë” ë°°ê²½ìƒ‰ ì¡°ì • */
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            backdrop-filter: blur(3px);
            -webkit-backdrop-filter: blur(3px);
        }

        /* íƒ­ ë²„íŠ¼ ìƒ‰ìƒ í†µì¼ì„± ìœ ì§€ */
        .tab-buttons .tab-btn.active {
            color: #6c5ce7;
            border-bottom-color: #6c5ce7;
            margin-bottom: -2px;
        }

        /* --- ğŸ“… ìº˜ë¦°ë” ì…€ ì‹œê° ê°œì„  --- */
        .calendar-day-cell {
            min-height: 85px; /* ì¼ì •ì´ ì ì„ ë• ë†’ì´ ì‘ê²Œ */
            max-height: 110px; /* ì¼ì •ì´ ë§ì„ ë• ë„ˆë¬´ ì»¤ì§€ì§€ ì•Šê²Œ */
            overflow: hidden;
            padding: 6px 6px 4px 6px;
            border-radius: 6px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
        }

        /* ì¼ì •ì´ ìˆëŠ” ë‚ ì€ ë°°ê²½ ê°•ì¡° */
        .calendar-day-cell.has-event {
            background-color: rgba(108, 92, 231, 0.08);
            border: 1px solid rgba(108, 92, 231, 0.15);
        }

        /* ìº˜ë¦°ë” ë‚´ ì¼ì • ë¸”ë¡ */
        .calendar-event {
            width: 100%;
            border-radius: 4px;
            font-size: 10px;
            padding: 2px 3px;
            margin-top: 3px;
            line-height: 1.2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ê²½ê¸° ì¼ì • (ë³´ë¼ìƒ‰ ê³„ì—´) */
        .calendar-event.match-schedule {
            background-color: rgba(144, 77, 240, 0.85);
            color: white;
            font-weight: 500;
        }

        /* ê°œì¸ ì¼ì • (íŒŒë€ìƒ‰ ê³„ì—´) */
        .calendar-event.personal-schedule {
            background-color: rgba(74, 144, 226, 0.85);
            color: white;
            font-weight: 500;
        }

        /* +Nê°œ ë”ë³´ê¸° í‘œì‹œ */
        .calendar-event.more-events {
            background: rgba(255, 255, 255, 0.8);
            border: 1px dashed rgba(108, 92, 231, 0.5);
            color: #6c5ce7;
            font-size: 10px;
            font-weight: 600;
            text-align: center;
            padding: 2px 0;
            width: 100%;
            border-radius: 4px;
            margin-top: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .calendar-event.more-events:hover {
            background-color: rgba(108, 92, 231, 0.1);
        }

    </style>
</head>
<body>

<header class="quick-menu">
    <div class="logo"><a href="/">Multi FC</a></div>
    <div class="header-icons">
        <button id="profile-menu-toggle" class="profile-icon" style="position: relative; display: none;">
            <i class="fas fa-user-circle"></i>
            <span id="notification-badge" class="notification-badge" style="display: none;"></span>
        </button>
        <button id="menu-toggle" class="menu-toggle-btn"><i class="fas fa-bars"></i></button>
    </div>


    <div id="profile-menu" class="user-menu">
        <div class="user-info">
            <strong><span id="user-menu-username">ì‚¬ìš©ì</span>ë‹˜</strong>
            <p>í™˜ì˜í•©ë‹ˆë‹¤!</p>
        </div>
        <ul>
            <li><a href="/notifications" id="nav-notifications-link"><i class="fas fa-bell"></i> ì•Œë¦¼ ëª©ë¡</a></li>
            <li><a href="/mypage"><i class="fas fa-user"></i> ë§ˆì´í˜ì´ì§€</a></li>
            <li><a href="/profile/edit"><i class="fas fa-user-edit"></i> í”„ë¡œí•„ ìˆ˜ì •</a></li>
            <li><a href="#" id="logout-button"><i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ</a></li>
        </ul>
    </div>

    <nav id="main-menu" class="main-menu">
        <ul>
            <li><a href="/"><i class="fas fa-home"></i> ë©”ì¸ (Home)</a></li>
            <li><a href="/fields"><i class="fas fa-search"></i> êµ¬ì¥ê²€ìƒ‰</a></li>
            <li><a href="/community"><i class="fas fa-users"></i> ì»¤ë®¤ë‹ˆí‹°</a></li>
            <li><a href="/chat"><i class="fas fa-comments"></i> ì‹¤ì‹œê°„ì±„íŒ…</a></li>
        </ul>
    </nav>
</header>

<main class="login-page-main">
    <div class="main-wrapper">
        <div class="main-section" id="full-width-section">
            <div class="login-container">
                <h1 class="title-login">ë§ˆì´í˜ì´ì§€</h1>

                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="tab-info">íšŒì›ì •ë³´</button>
                    <button class="tab-btn" data-tab="tab-calendar">ìº˜ë¦°ë”</button>
                    <button class="tab-btn" data-tab="tab-friends">ì¹œêµ¬ ê´€ë¦¬</button>
                </div>

                <div id="day-schedule-popup" style="display: none;"></div>

                <div id="tab-info" class="tab-content active">
                    <h3 style="font-size: 24px; color: #2c3e50; margin-top: 20px; margin-bottom: 25px;">íšŒì›ì •ë³´ í™•ì¸</h3>

                    <div style="text-align: center; margin-bottom: 15px;">
                        <img id="profile-preview-view" th:src="@{/images/default-profile.png}" alt="í”„ë¡œí•„ ì‚¬ì§„" class="info-view-profile-pic">
                    </div>

                    <div class="score-display">
                        <div class="score-item">
                            <span class="icon-box"><i class="fas fa-running"></i></span>
                            ì‹¤ë ¥ ë ˆë²¨
                            <strong id="view-skill-level">ì¤‘ê¸‰</strong>
                        </div>
                        <div class="score-item">
                            <span class="icon-box"><i class="fas fa-crosshairs"></i></span>
                            í¬ì§€ì…˜
                            <strong id="view-position-score">í”½ì†Œ (FIXO)</strong>
                        </div>
                    </div>

                    <div class="info-view-group">
                        <label>ì´ë©”ì¼</label>
                        <div id="view-email" class="info-view-text">...</div>
                    </div>

                    <div class="info-view-group">
                        <label>ì•„ì´ë””</label>
                        <div id="view-username" class="info-view-text">...</div>
                    </div>

                    <div class="info-view-group">
                        <label>ë‹‰ë„¤ì„</label>
                        <div id="view-nickname" class="info-view-text">...</div>
                    </div>

                    <div class="info-view-group">
                        <label>ì£¼ì†Œ</label>
                        <div id="view-address" class="info-view-text">...</div>
                    </div>

                    <div style="text-align: center; margin-top: 30px;">
                        <a href="/profile/edit" id="edit-profile-button" class="login-button" style="text-decoration: none; padding: 12px 30px; font-size: 16px; width: auto; background: #6c5ce7; border-radius: 8px; box-shadow: 0 4px 10px rgba(108, 92, 231, 0.3);">
                            <i class="fas fa-edit" style="margin-right: 5px;"></i> íšŒì›ì •ë³´ ìˆ˜ì •í•˜ê¸°
                        </a>
                    </div>
                </div>

                <div id="tab-calendar" class="tab-content">
                    <h3 style="font-size: 24px; color: #2c3e50; margin-top: 20px; margin-bottom: 20px;">ë‚´ ì¼ì •</h3>

                    <div class="calendar-layout-wrapper">

                        <div class="calendar-container">
                            <div class="calendar-header">
                                <nav class="calendar-nav">
                                    <button id="prev-month">&lt;</button>
                                </nav>
                                <h2 id="current-month-year">2025ë…„ 10ì›”</h2>
                                <nav class="calendar-nav">
                                    <button id="next-month">&gt;</button>
                                </nav>
                            </div>
                            <div class="calendar-grid" id="calendar-days-header">
                                <div class="calendar-header-cell">ì¼</div>
                                <div class="calendar-header-cell">ì›”</div>
                                <div class="calendar-header-cell">í™”</div>
                                <div class="calendar-header-cell">ìˆ˜</div>
                                <div class="calendar-header-cell">ëª©</div>
                                <div class="calendar-header-cell">ê¸ˆ</div>
                                <div class="calendar-header-cell">í† </div>
                            </div>
                            <div class="calendar-grid" id="calendar-days-grid"></div>
                        </div>

                        <div id="fixed-schedule-detail">

                            <button id="close-detail-btn">&times;</button>
                            <h3 id="detail-current-date" style="font-size: 16px; border-bottom: 1px solid #f0f0f0; padding-bottom: 8px; margin-bottom: 10px;">11ì›” 05ì¼ ì¼ì •</h3>

                            <ul class="fixed-schedule-list" id="fixed-schedule-list" style="list-style: none; padding: 0; margin-bottom: 15px; max-height: 200px; overflow-y: auto;">
                            </ul>

                            <h3 id="new-schedule-title" style="font-size: 16px; margin-top: 15px; font-weight: 700; display: none;">ìƒˆ ê°œì¸ ì¼ì • ë“±ë¡</h3>
                            <h3 id="personal-schedule-title" style="font-size: 16px; margin-top: 15px; font-weight: 700;">ê°œì¸ ì¼ì • ìƒì„¸ ì •ë³´</h3>

                            <div id="fixed-detail-edit-area">
                                <input type="hidden" id="selected-schedule-id">
                                <input type="time" id="selected-schedule-time" style="width: 100%; padding: 8px; margin-bottom: 8px; border: 1px solid #ddd; display: none;">

                                <input type="text" id="selected-schedule-name" placeholder="ì¼ì •ëª…" disabled style="width: 100%; padding: 8px; margin-bottom: 8px; border: 1px solid #ddd;">
                                <textarea id="selected-schedule-content" rows="4" placeholder="ì„¸ë¶€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”." disabled style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd;"></textarea>

                                <div style="text-align: right;">
                                    <button id="save-schedule-btn" disabled style="padding: 8px 15px; margin-left: 10px; background-color: #ccc; color: white; border: none; border-radius: 5px;">ì €ì¥</button>
                                    <button id="delete-schedule-btn" disabled style="padding: 8px 15px; background-color: #ccc; color: white; border: none; border-radius: 5px;">ì‚­ì œ</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tab-friends" class="tab-content">

                    <div class="friends-management-title-wrapper">
                        <h3>ì¹œêµ¬ ê´€ë¦¬</h3>
                        <button class="friends-add-icon-btn" onclick="location.href='/friends'">
                            <i class="fas fa-user-plus"></i>
                        </button>
                    </div>

                    <div class="tab-buttons sub-tabs">
                        <button class="sub-tab-btn active" data-sub-tab="sub-tab-friend-list">ì¹œêµ¬ ëª©ë¡</button>
                        <button class="sub-tab-btn" data-sub-tab="sub-tab-friend-add">ì¹œêµ¬ ìš”ì²­</button>
                    </div>

                    <div id="sub-tab-friend-list" class="sub-tab-content active">
                        <p style="font-size: 14px; color: #6c5ce7; font-weight: 600; text-align: right; margin-bottom: 15px;">
                            ì´ <span id="friend-count-display">0</span>ëª…
                        </p>

                        <div class="friend-list-search-group">
                            <input type="text" id="friend-list-search-input" placeholder="ì¹œêµ¬ ë‹‰ë„¤ì„ ê²€ìƒ‰">
                            <button onclick="searchFriendList()">ê²€ìƒ‰</button>
                        </div>

                        <ul id="friend-list" class="friend-item-list">
                        </ul>
                        <p id="no-friends-message" style="color: #777; text-align: center; padding: 20px; display: none;">
                            ë“±ë¡ëœ ì¹œêµ¬ê°€ ì—†ìŠµë‹ˆë‹¤. 'ì¹œêµ¬ ìš”ì²­' íƒ­ì—ì„œ ìš”ì²­ì„ í™•ì¸í•˜ì„¸ìš”.
                        </p>
                    </div>

                    <div id="sub-tab-friend-add" class="sub-tab-content">

                        <ul id="friend-add-search-results" class="friend-item-list">
                        </ul>

                        <div id="friend-request-message" style="border: 1px dashed #ddd; border-radius: 8px; padding: 15px; min-height: 100px; text-align: center; display: none; margin-top: 20px;">
                            <p style="color: #999;">ìƒˆë¡œìš´ ì¹œêµ¬ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>

                </div> </div>
        </div>
    </div>
</main>

<script>
    // --- (â˜…ê³µí†µâ˜…) ë©”ë‰´ í† ê¸€ ë° ë¡œê·¸ì•„ì›ƒ ë¡œì§ ---
    const menuToggle = document.getElementById('menu-toggle');
    const mainMenu = document.getElementById('main-menu'); // ë©”ì¸ ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´
    const profileMenuToggle = document.getElementById('profile-menu-toggle');
    const profileMenu = document.getElementById('profile-menu');
    const logoutButton = document.getElementById('logout-button');

    if (menuToggle) {
        menuToggle.addEventListener('click', (event) => {
            event.stopPropagation(); // ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€
            mainMenu.classList.toggle('show');
            if(profileMenu) profileMenu.classList.remove('show'); // í”„ë¡œí•„ ë©”ë‰´ëŠ” ë‹«ê¸°
        });
    }
    if (profileMenuToggle) {
        profileMenuToggle.addEventListener('click', (event) => {
            event.stopPropagation(); // ì´ë²¤íŠ¸ ë²„ë¸”ë§ ë°©ì§€
            if(profileMenu) profileMenu.classList.toggle('show');
            if(mainMenu) mainMenu.classList.remove('show'); // ë©”ì¸ ë©”ë‰´ëŠ” ë‹«ê¸°
        });
    }
    // ë¬¸ì„œ ì „ì²´ í´ë¦­ ì‹œ ë©”ë‰´ ë‹«ê¸°
    document.addEventListener('click', (event) => {
        const isClickInsideMainMenu = mainMenu && mainMenu.contains(event.target);
        const isClickInsideProfileMenu = profileMenu && profileMenu.contains(event.target);
        const isMenuToggle = menuToggle && menuToggle.contains(event.target);
        const isProfileToggle = profileMenuToggle && profileMenuToggle.contains(event.target);

        if (mainMenu && !isClickInsideMainMenu && !isMenuToggle) {
            mainMenu.classList.remove('show');
        }
        if (profileMenu && !isClickInsideProfileMenu && !isProfileToggle) {
            profileMenu.classList.remove('show');
        }
    });
    if (logoutButton) {
        logoutButton.addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem('accessToken');
            window.location.href = '/login';
        });
    }

    // --- ì•Œë¦¼ ë°°ì§€ ë° ì¸ì¦ ìƒíƒœ ë¡œì§ ---
    const badge = document.getElementById('notification-badge');
    let hasReviewNotif = false;
    let hasScheduleNotif = false;

    function updateGlobalBadge() {
        if (badge) {
            badge.style.display = (hasReviewNotif || hasScheduleNotif) ? 'block' : 'none';
        }
    }

    async function checkPendingReviews() {
        await new Promise(r => setTimeout(r, 200));
        hasReviewNotif = localStorage.getItem('hasReadReviews') !== 'true';
    }
    async function checkUpcomingSchedules() {
        await new Promise(r => setTimeout(r, 500));
        hasScheduleNotif = true;
    }

    // --- ë‚´ ì •ë³´ (ë”ë¯¸, ERD ë°˜ì˜) ---
    async function fetchMyInfo(token) {
        const myInfo = {
            email: "real.user@example.com",
            username: "RealUser123",
            nickname: "ë¦¬ì–¼ìœ ì €",
            position: "í”½ì†Œ (FIXO)",
            address: "ì„œìš¸ì‹œ ì„œì´ˆêµ¬",
            skillLevel: "ì¤‘ê¸‰"
        };
        if(document.getElementById('view-email')) document.getElementById('view-email').textContent = myInfo.email;
        if(document.getElementById('view-username')) document.getElementById('view-username').textContent = myInfo.username;
        if(document.getElementById('view-nickname')) document.getElementById('view-nickname').textContent = myInfo.nickname;
        if(document.getElementById('view-address')) document.getElementById('view-address').textContent = myInfo.address;
        if(document.getElementById('view-position-score')) document.getElementById('view-position-score').textContent = myInfo.position;
        if(document.getElementById('view-skill-level')) document.getElementById('view-skill-level').textContent = myInfo.skillLevel;
        if(document.getElementById('user-menu-username')) document.getElementById('user-menu-username').textContent = myInfo.nickname;
    }

    // --- ìº˜ë¦°ë” (ê²½ê¸° ì¼ì •, ì˜¤ëŠ˜ ë‚ ì§œ ê°•ì¡°, í˜„ì¬ ì›” í‘œì‹œ ë¡œì§) ---
    const monthYearElement = document.getElementById('current-month-year');
    const daysGrid = document.getElementById('calendar-days-grid');
    const prevMonthBtn = document.getElementById('prev-month');
    const nextMonthBtn = document.getElementById('next-month');

    const fixedDetailWindow = document.getElementById('fixed-schedule-detail');
    const detailList = document.getElementById('fixed-schedule-list');
    const detailDateTitle = document.getElementById('detail-current-date');
    const saveBtn = document.getElementById('save-schedule-btn');
    const deleteBtn = document.getElementById('delete-schedule-btn');
    const scheduleNameInput = document.getElementById('selected-schedule-name');
    const scheduleContentInput = document.getElementById('selected-schedule-content');
    const selectedScheduleIdInput = document.getElementById('selected-schedule-id');
    const closeDetailBtn = document.getElementById('close-detail-btn');
    const scheduleTimeInput = document.getElementById('selected-schedule-time');

    const newScheduleTitle = document.getElementById('new-schedule-title');
    const personalScheduleTitle = document.getElementById('personal-schedule-title');

    let currentDate = new Date();
    currentDate.setDate(1); // í•­ìƒ 1ì¼ë¡œ ì„¤ì •í•˜ì—¬ ì›” ê³„ì‚° ê¸°ì¤€ì  í†µì¼

    // â­â­ MOCK_SCHEDULES - year/month ì†ì„± ì¶”ê°€ ë° ë°ì´í„° ì •ë¦¬
    let MOCK_SCHEDULES = [
        { id: 1, year: 2025, month: 10, day: 5, time: "09:00", type: 'match', title: '09:00 ê²½ê¸° ì¼ì •', detail: "ì¥ì†Œ: ê°•ë‚¨ í’‹ì‚´ì¥, ë ˆë²¨: ì¤‘ê¸‰, ì¸ì›: 10ëª…" },
        { id: 2, year: 2025, month: 10, day: 5, time: "13:00", type: 'personal', title: '13:00 ê°œì¸ ì•½ì†', detail: "ì¶•êµ¬í™” ì„¸ì²™ ë° ê°œì¸ ì—°ìŠµ ì¼ì •" },
        { id: 3, year: 2025, month: 10, day: 25, time: "20:00", type: 'match', title: 'ìˆ˜ì› íŒ€ ë§¤ì¹˜', detail: "ì¥ì†Œ: ìˆ˜ì› ì›”ë“œì»µ êµ¬ì¥, ë ˆë²¨: ê³ ê¸‰" },
        { id: 4, year: 2025, month: 11, day: 10, time: "18:00", type: 'personal', title: 'ì¹œêµ¬ì™€ í’‹ì‚´', detail: "ì ì‹¤ í’‹ì‚´ì¥" }
    ];

    // âœ… localStorage ë°ì´í„°ì™€ ë™ê¸°í™”ë˜ë„ë¡ ìˆ˜ì •
    function loadSchedulesFromStorage() {
        // localStorageì— ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        const matchData = JSON.parse(localStorage.getItem("matches")) || [];
        const personalData = JSON.parse(localStorage.getItem("personalSchedules")) || [];

        // localStorageì— ì €ì¥ëœ match ë°ì´í„° ë³€í™˜ (monthëŠ” JS ê¸°ì¤€ 0~11ë¡œ ë³€í™˜)
        const matchSchedules = matchData.map(m => {
            const dateObj = new Date(m.date || m.datetime || "2025-11-01T00:00:00");
            return {
                id: m.id,
                year: dateObj.getFullYear(),
                month: dateObj.getMonth(),
                day: dateObj.getDate(),
                time: m.time || dateObj.toTimeString().slice(0, 5),
                type: "match",
                title: m.title || m.name || "ê²½ê¸° ì¼ì •",
                detail: m.location || "ê²½ê¸° ì¥ì†Œ ë¯¸ì •"
            };
        });

        // ê°œì¸ ì¼ì •
        const personalSchedules = personalData.map(p => {
            const dateObj = new Date(p.date || p.datetime || "2025-11-01T00:00:00");
            return {
                id: p.id,
                year: dateObj.getFullYear(),
                month: dateObj.getMonth(),
                day: dateObj.getDate(),
                time: p.time || dateObj.toTimeString().slice(0, 5),
                type: "personal",
                title: p.title || p.name || "ê°œì¸ ì¼ì •",
                detail: p.detail || ""
            };
        });

        // ë”ë¯¸ ë°ì´í„° + ì‹¤ì œ localStorage ë°ì´í„° ë³‘í•©
        const combined = [...MOCK_SCHEDULES, ...matchSchedules, ...personalSchedules];

        // ì¤‘ë³µ ì œê±° (id ê¸°ì¤€)
        const unique = combined.filter(
            (item, index, self) => index === self.findIndex((t) => t.id === item.id)
        );

        MOCK_SCHEDULES = unique;
    }


    function openDaySchedule(day, event) {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth(); // 0ë¶€í„° ì‹œì‘

        const schedulesToday = MOCK_SCHEDULES.filter(s =>
            s.year === year && s.month === month && s.day === day
        );

        detailDateTitle.textContent = `${month + 1}ì›” ${day}ì¼ ì¼ì •`;
        detailList.innerHTML = '';

        fixedDetailWindow.dataset.selectedDate = `${year}-${month + 1}-${day}`;


        if (schedulesToday.length > 0) {
            personalScheduleTitle.style.display = 'block';
            newScheduleTitle.style.display = 'none';
            scheduleTimeInput.style.display = 'none';

            schedulesToday.forEach(schedule => {
                const li = document.createElement('li');
                const eventClass = schedule.type === 'match' ? 'match-schedule' : 'personal-schedule';

                li.className = eventClass;
                li.dataset.scheduleId = schedule.id;

                li.innerHTML = `<span style="font-weight: 700;">${schedule.time}</span> ${schedule.title}`;

                li.onclick = (e) => bindScheduleToDetail(e, schedule);

                detailList.appendChild(li);
            });
            clearDetailEditArea();

        } else {
            personalScheduleTitle.style.display = 'none';
            newScheduleTitle.style.display = 'block';
            setNewScheduleMode();
        }
        fixedDetailWindow.style.display = 'block';
        event.stopPropagation();
    }

    function setNewScheduleMode() {
        detailList.innerHTML = '<li style="color: #6c5ce7; text-align: center; padding: 10px;">ìƒˆ ì¼ì •ì„ ë“±ë¡í•˜ì„¸ìš”.</li>';
        scheduleNameInput.value = '';
        scheduleContentInput.value = '';
        selectedScheduleIdInput.value = '';

        scheduleTimeInput.value = '';
        scheduleTimeInput.style.display = 'block';

        saveBtn.disabled = false;
        saveBtn.textContent = "ë“±ë¡";
        saveBtn.style.backgroundColor = 'rgba(46, 204, 113, 0.85)';
        saveBtn.setAttribute('data-mode', 'add');
        deleteBtn.style.display = 'none';

        scheduleNameInput.disabled = false;
        scheduleContentInput.disabled = false;
        scheduleNameInput.placeholder = "ì¼ì •ëª… (í•„ìˆ˜)";
        scheduleContentInput.placeholder = "ì„¸ë¶€ ë‚´ìš© (ì„ íƒ)";
    }

    function clearDetailEditArea() {
        scheduleNameInput.value = '';
        scheduleContentInput.value = '';
        selectedScheduleIdInput.value = '';

        personalScheduleTitle.style.display = 'block';
        newScheduleTitle.style.display = 'none';
        scheduleTimeInput.style.display = 'none';

        saveBtn.disabled = true;
        saveBtn.textContent = "ì €ì¥";
        saveBtn.style.backgroundColor = 'rgba(204, 204, 204, 0.7)';
        saveBtn.setAttribute('data-mode', 'edit');
        deleteBtn.style.display = 'inline-block';
        deleteBtn.disabled = true;
        deleteBtn.style.backgroundColor = 'rgba(204, 204, 204, 0.7)';

        scheduleNameInput.disabled = true;
        scheduleContentInput.disabled = true;
        scheduleNameInput.placeholder = "ì¼ì •ì„ ì„ íƒí•˜ê±°ë‚˜, ê²½ê¸°ëŠ” ìƒì„¸ë³´ê¸°ë¥¼ ì´ìš©í•˜ì„¸ìš”.";
        scheduleContentInput.placeholder = "ì¼ì •ì„ ì„ íƒí•˜ê±°ë‚˜, ê²½ê¸°ëŠ” ìƒì„¸ë³´ê¸°ë¥¼ ì´ìš©í•˜ì„¸ìš”.";

        detailList.querySelectorAll('li').forEach(li => li.classList.remove('active'));
    }

    function bindScheduleToDetail(event, schedule) {
        if (schedule.type === 'match') {
            window.location.href = `/schedule/detail/${schedule.id}`;
            return;
        }

        clearDetailEditArea();
        event.currentTarget.classList.add('active');

        personalScheduleTitle.style.display = 'block';
        newScheduleTitle.style.display = 'none';
        scheduleTimeInput.style.display = 'block';

        scheduleNameInput.value = schedule.title;
        scheduleContentInput.value = schedule.detail;
        selectedScheduleIdInput.value = schedule.id;
        scheduleTimeInput.value = schedule.time;

        if (schedule.type === 'personal') {
            scheduleNameInput.disabled = false;
            scheduleContentInput.disabled = false;
            saveBtn.disabled = false;
            saveBtn.textContent = "ì €ì¥";
            saveBtn.style.backgroundColor = 'rgba(74, 144, 226, 0.85)';
            saveBtn.setAttribute('data-mode', 'edit');
            deleteBtn.disabled = false;
            deleteBtn.style.backgroundColor = 'rgba(231, 76, 60, 0.85)';
            scheduleNameInput.placeholder = "ì¼ì •ëª… (ìˆ˜ì • ê°€ëŠ¥)";
            scheduleContentInput.placeholder = "ì„¸ë¶€ ë‚´ìš© (ìˆ˜ì • ê°€ëŠ¥)";
        }
    }

    saveBtn.addEventListener('click', function() {
        if(saveBtn.disabled) return;

        const id = selectedScheduleIdInput.value;
        const newTitle = scheduleNameInput.value.trim();
        const newDetail = scheduleContentInput.value.trim();
        const newTime = scheduleTimeInput.value;

        if (!newTitle || !newTime) {
            alert("ì¼ì •ëª…ê³¼ ì‹œê°„ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        const selectedDateParts = fixedDetailWindow.dataset.selectedDate.split('-');
        const selectedYear = parseInt(selectedDateParts[0]);
        const selectedMonth = parseInt(selectedDateParts[1]) - 1; // monthëŠ” 0ë¶€í„° ì‹œì‘
        const selectedDay = parseInt(selectedDateParts[2]);

        if (!id) { // ë“±ë¡ (IDê°€ ì—†ì„ ë•Œ)
            const newId = Date.now();

            const newSchedule = {
                id: newId,
                year: selectedYear,
                month: selectedMonth,
                day: selectedDay,
                time: newTime,
                type: 'personal',
                title: newTitle,
                detail: newDetail
            };

            MOCK_SCHEDULES.push(newSchedule);
            alert(`âœ… ìƒˆ ê°œì¸ ì¼ì •ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!`);

        } else { // ìˆ˜ì • (IDê°€ ìˆì„ ë•Œ)
            const targetIndex = MOCK_SCHEDULES.findIndex(s => s.id === parseInt(id));
            if (targetIndex !== -1) {
                MOCK_SCHEDULES[targetIndex].title = newTitle;
                MOCK_SCHEDULES[targetIndex].detail = newDetail;
                MOCK_SCHEDULES[targetIndex].time = newTime;
                MOCK_SCHEDULES[targetIndex].year = selectedYear;
                MOCK_SCHEDULES[targetIndex].month = selectedMonth;
                MOCK_SCHEDULES[targetIndex].day = selectedDay;
                alert(`âœ… ê°œì¸ ì¼ì •ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤! ID: ${id}`);
            }
        }
        renderCalendar();
        fixedDetailWindow.style.display = 'none';
    });

    deleteBtn.addEventListener('click', function() {
        if(deleteBtn.disabled) return;

        if (confirm("ì •ë§ë¡œ ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            const id = selectedScheduleIdInput.value;
            const initialLength = MOCK_SCHEDULES.length;
            MOCK_SCHEDULES = MOCK_SCHEDULES.filter(s => s.id !== parseInt(id));

            if (MOCK_SCHEDULES.length < initialLength) {
                alert(`âœ… ê°œì¸ ì¼ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤! ID: ${id}`);
                renderCalendar();
                fixedDetailWindow.style.display = 'none';
            }
        }
    });

    function renderCalendar() {
        if (!daysGrid) return;

        daysGrid.innerHTML = '';

        const today = new Date();
        const currentDayOfMonth = today.getDate();
        const currentMonth = today.getMonth();
        const currentYear = today.getFullYear();


        const year = currentDate.getFullYear();
        const month = currentDate.getMonth(); // 0-11
        monthYearElement.textContent = `${year}ë…„ ${month + 1}ì›”`;
        const firstDayOfMonth = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        for (let i = 0; i < firstDayOfMonth; i++) {
            const cell = document.createElement('div');
            cell.classList.add('calendar-day-cell', 'other-month');
            daysGrid.appendChild(cell);
        }

        for (let day = 1; day <= daysInMonth; day++) {
            const cell = document.createElement('div');
            cell.classList.add('calendar-day-cell');
            cell.textContent = day;

            if (year === currentYear && month === currentMonth && day === currentDayOfMonth) {
                cell.classList.add('today');
            }

            const schedulesToday = MOCK_SCHEDULES.filter(s =>
                s.year === year && s.month === month && s.day === day
            );

            if (schedulesToday.length > 0) {
                // 1ï¸âƒ£ ìµœëŒ€ 2ê°œê¹Œì§€ë§Œ í‘œì‹œ
                const maxVisible = 2;
                const visibleSchedules = schedulesToday.slice(0, maxVisible);

                visibleSchedules.forEach(schedule => {
                    const eventDiv = document.createElement('div');
                    const eventClass = schedule.type === 'match' ? 'match-schedule' : 'personal-schedule';
                    eventDiv.className = `calendar-event ${eventClass}`;
                    eventDiv.textContent = `${schedule.time}`;
                    eventDiv.title = schedule.title;
                    eventDiv.onclick = (e) => {
                        e.stopPropagation();
                        openDaySchedule(day, e); // í´ë¦­ ì‹œ ìƒì„¸ì°½ ì—´ê¸°
                    };
                    cell.appendChild(eventDiv);
                });

                // 2ï¸âƒ£ ì¼ì •ì´ ë” ìˆìœ¼ë©´ â€œ+N ë”ë³´ê¸°â€ í‘œì‹œ
                if (schedulesToday.length > maxVisible) {
                    const moreDiv = document.createElement('div');
                    moreDiv.className = 'calendar-event more-events';
                    moreDiv.textContent = `+${schedulesToday.length - maxVisible}ê°œ ë”ë³´ê¸°`;
                    moreDiv.style.backgroundColor = 'rgba(108, 92, 231, 0.15)';
                    moreDiv.style.color = '#6c5ce7';
                    moreDiv.style.textAlign = 'center';
                    moreDiv.style.fontWeight = '600';
                    moreDiv.style.border = '1px dashed #6c5ce7';
                    moreDiv.style.cursor = 'pointer';
                    moreDiv.onclick = (e) => {
                        e.stopPropagation();
                        openDaySchedule(day, e); // í´ë¦­ ì‹œ í•´ë‹¹ ë‚ ì§œ ìƒì„¸ì°½ìœ¼ë¡œ ì´ë™
                    };
                    cell.appendChild(moreDiv);
                }
            }

            const dayToPass = day;
            cell.onclick = (e) => openDaySchedule(dayToPass, e);

            daysGrid.appendChild(cell);
        }
    }
    if (prevMonthBtn) prevMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
        fixedDetailWindow.style.display = 'none';
    });
    if (nextMonthBtn) nextMonthBtn.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
        fixedDetailWindow.style.display = 'none';
    });

    if (closeDetailBtn) {
        closeDetailBtn.addEventListener('click', () => {
            fixedDetailWindow.style.display = 'none';
        });
    }

    // --- ì¹œêµ¬ ìš”ì²­ ë”ë¯¸ ë°ì´í„° ---
    let MOCK_FRIENDS = [
        { id: 101, name: 'User1', userId: 'user1_id' },
        { id: 102, name: 'User2', userId: 'user2_id' },
        { id: 103, name: 'ì¶•êµ¬ì™•', userId: 'soccerKing_id' }
    ];
    let MOCK_REQUESTS = [
        { id: 1, name: 'RequestUserA', userId: 'requestA_id', type: 'received' },
        { id: 2, name: 'RequestUserB', userId: 'requestB_id', type: 'received' }
    ];

    function handleRequestItemClick(event) {
        const clickedItem = event.currentTarget;
        if (event.target.closest('.request-actions')) {
            return;
        }
        const container = clickedItem.parentElement;
        container.querySelectorAll('.friend-request-item.active').forEach(item => {
            if (item !== clickedItem) {
                item.classList.remove('active');
            }
        });
        clickedItem.classList.toggle('active');
    }

    function renderFriendList() {
        const listContainer = document.getElementById('friend-list');
        const countDisplay = document.getElementById('friend-count-display');
        const messageContainer = document.getElementById('no-friends-message');
        const searchInput = document.getElementById('friend-list-search-input') ? document.getElementById('friend-list-search-input').value.toLowerCase() : '';

        listContainer.innerHTML = '';
        const filteredFriends = MOCK_FRIENDS.filter(f => f.name.toLowerCase().includes(searchInput) || f.userId.toLowerCase().includes(searchInput));

        if (countDisplay) countDisplay.textContent = filteredFriends.length;

        if (filteredFriends.length === 0) {
            if(messageContainer) messageContainer.style.display = 'block';
            return;
        }
        if(messageContainer) messageContainer.style.display = 'none';

        filteredFriends.forEach(friend => {
            const li = document.createElement('li');
            li.dataset.friendId = friend.id;
            li.innerHTML = `
                <strong>${friend.name}</strong> (${friend.userId})
                <div class="action-buttons">
                    <button class="btn-chat" onclick="event.stopPropagation(); alert('${friend.name}ë‹˜ê³¼ 1:1 ì±„íŒ… ì‹œì‘');">ì±„íŒ…</button>
                    <button class="btn-delete" onclick="event.stopPropagation(); deleteFriend(${friend.id}, '${friend.name}');">ì‚­ì œ</button>
                </div>
            `;
            li.onclick = () => {
                listContainer.querySelectorAll('li').forEach(item => item.classList.remove('active'));
                li.classList.add('active');
            };
            listContainer.appendChild(li);
        });
    }

    function searchFriendList() {
        renderFriendList();
    }

    function deleteFriend(id, name) {
        if (confirm(`${name}ë‹˜ì„ ì¹œêµ¬ ëª©ë¡ì—ì„œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            MOCK_FRIENDS = MOCK_FRIENDS.filter(f => f.id !== id);
            renderFriendList();
            alert(`${name}ë‹˜ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
    }

    function renderFriendRequests() {
        const listContainer = document.getElementById('friend-add-search-results');
        const messageContainer = document.getElementById('friend-request-message');
        listContainer.innerHTML = '';

        const receivedRequests = MOCK_REQUESTS.filter(r => r.type === 'received');

        if (receivedRequests.length === 0) {
            if(messageContainer) messageContainer.style.display = 'block';
            return;
        }
        if(messageContainer) messageContainer.style.display = 'none';

        receivedRequests.forEach(request => {
            const li = document.createElement('li');
            li.className = 'friend-request-item';
            li.dataset.requestId = request.id;

            li.onclick = handleRequestItemClick;

            li.innerHTML = `
                <span>${request.name} (${request.userId})</span>
                <div class="request-actions">
                    <button class="btn-accept" onclick="event.stopPropagation(); handleFriendRequest(${request.id}, '${request.name}', 'accept');"><i class="fas fa-check"></i> ìˆ˜ë½</button>
                    <button class="btn-reject" onclick="event.stopPropagation(); handleFriendRequest(${request.id}, '${request.name}', 'reject');"><i class="fas fa-times"></i> ê±°ì ˆ</button>
                </div>
            `;
            listContainer.appendChild(li);
        });
    }

    function handleFriendRequest(id, name, action) {
        MOCK_REQUESTS = MOCK_REQUESTS.filter(r => r.id !== id);
        if (action === 'accept') {
            MOCK_FRIENDS.push({ id: id, name: name, userId: name.toLowerCase() + '_id' });
            alert(`${name}ë‹˜ì˜ ì¹œêµ¬ ìš”ì²­ì„ ìˆ˜ë½í–ˆìŠµë‹ˆë‹¤!`);
        } else {
            alert(`${name}ë‹˜ì˜ ì¹œêµ¬ ìš”ì²­ì„ ê±°ì ˆí–ˆìŠµë‹ˆë‹¤.`);
        }
        renderFriendRequests();
        renderFriendList();
    }

    const subTabButtons = document.querySelectorAll('.sub-tabs .sub-tab-btn');
    const subTabContents = document.querySelectorAll('.sub-tab-content');
    subTabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetTab = button.getAttribute('data-sub-tab');
            subTabButtons.forEach(btn => btn.classList.remove('active'));
            subTabContents.forEach(content => content.classList.remove('active'));
            button.classList.add('active');
            document.getElementById(targetTab).classList.add('active');

            if (targetTab === 'sub-tab-friend-add') {
                renderFriendRequests();
            } else if (targetTab === 'sub-tab-friend-list') {
                renderFriendList();
            }
        });
    });

    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetTab = button.getAttribute('data-tab');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            button.classList.add('active');
            document.getElementById(targetTab).classList.add('active');

            fixedDetailWindow.style.display = 'none'; // íƒ­ ì „í™˜ ì‹œ ìƒì„¸ ì°½ ë‹«ê¸°
        });
    });


    document.addEventListener('DOMContentLoaded', async () => {
        const accessToken = localStorage.getItem('accessToken');
        if (!accessToken) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ í˜ì´ì§€ì…ë‹ˆë‹¤.");
            window.location.href = '/login';
        } else {
            if (profileMenuToggle) profileMenuToggle.style.display = 'block';
            await checkPendingReviews();
            await checkUpcomingSchedules();
            updateGlobalBadge();
            fetchMyInfo(accessToken);
            loadSchedulesFromStorage();

            if (daysGrid) {
                renderCalendar();
                fixedDetailWindow.style.display = 'none'; // ì´ˆê¸° ë¡œë“œ ì‹œ ìº˜ë¦°ë” ìƒì„¸ì°½ ë‹«ê¸° ê¸°ëŠ¥
            }

            const urlParams = new URLSearchParams(window.location.search);
            const mainTab = urlParams.get('tab');
            const subTab = urlParams.get('subtab');

            if (mainTab && mainTab === 'friends') {
                const friendsTabBtn = document.querySelector('.tab-btn[data-tab="tab-friends"]');
                if (friendsTabBtn) friendsTabBtn.click();
                if (subTab && subTab === 'add') {
                    const friendAddSubTabBtn = document.querySelector('.sub-tab-btn[data-sub-tab="sub-tab-friend-add"]');
                    if (friendAddSubTabBtn) friendAddSubTabBtn.click();
                } else {
                    const friendListSubTabBtn = document.querySelector('.sub-tab-btn[data-sub-tab="sub-tab-friend-list"]');
                    if (friendListSubTabBtn) friendListSubTabBtn.click();
                }
            } else if (mainTab && mainTab === 'calendar') {
                const calendarTabBtn = document.querySelector('.tab-btn[data-tab="tab-calendar"]');
                if (calendarTabBtn) calendarTabBtn.click();
            }
            else {
                const infoTabBtn = document.querySelector('.tab-btn[data-tab="tab-info"]');
                const infoTabContent = document.getElementById('tab-info');
                if (infoTabBtn) infoTabBtn.classList.add('active');
                if (infoTabContent) infoTabContent.classList.add('active');
            }
            renderFriendList();
        }
    });

    if (localStorage.getItem("calendarUpdated") === "true") {
        localStorage.removeItem("calendarUpdated");
        window.location.reload();
    }

    // âœ… ë‹¤ë¥¸ í˜ì´ì§€(ì˜ˆ: ê²½ê¸° ì·¨ì†Œ)ì—ì„œ ëŒì•„ì˜¨ ê²½ìš° ìë™ ìƒˆë¡œê³ ì¹¨
    if (localStorage.getItem("calendarUpdated") === "true") {
        localStorage.removeItem("calendarUpdated");

        // â­ ë°©ë²• 1: ê°€ì¥ í™•ì‹¤í•˜ê²Œ ì „ì²´ ìƒˆë¡œê³ ì¹¨
        window.location.reload();

        // â­ (ì„ íƒ) ë°©ë²• 2: ë§Œì•½ ìº˜ë¦°ë” ê°ì²´ê°€ ë³€ìˆ˜ë¡œ ìˆë‹¤ë©´, ì•„ë˜ ì½”ë“œë¡œ ëŒ€ì²´ ê°€ëŠ¥
        // calendar.refetchEvents();
    }

</script>
</body>
</html>